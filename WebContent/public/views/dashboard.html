<!DOCTYPE html>
	<html>
		<head>
			<meta charset="UTF-8">
			<title>Amazon</title>
			<link rel="stylesheet" href="../styles/dashboard.css"/>
		</head>
		<body>
			<nav>
				<div id="data">
					<ul>
						<li>
                			<a href="products.html">Publish a product</a>
                		</li>
						<li>
                			<a href="update.html">Update account</a>
                		</li>
                		<li>
                			<a href="delete.html">Delete account</a>
                		</li>
                		<li>
                			<a id="btn">Logout</a>
                		</li>
					</ul>
				</div>
			</nav>
			<script>
				const logoutBtn = document.getElementById("btn");

				logoutBtn.addEventListener("click", function() {
					console.log("button");
					
					const endpoint = "http://localhost:8080/Amazon/logout";
		
					let fetchData = {
						method: 'POST',
						headers: new Headers()
					}
					
					fetch(endpoint, fetchData)
					.then(function() {
						console.log("Success");
					})
					.catch(function() {
						console.log("Failed")
					})
				});
				
				let user = "";
				var data = [];

				const endpoint = fetch("http://localhost:8080/Amazon/dashboard");
				
				endpoint.then(response => {
					return response.json();
				})
				.then(people => {
					data = people;
					document.getElementById("data").innerHTML = data.map(user => 
						`<div id=${user.id} class="detail">
							<div>Title: ${user.title}</div>
							<div>Description: ${user.description}</div>
							<div>Image: ${user.image}</div>
							<div>Amount: ${user.amount}</div>
						</div>`
					).join('');

					const detail = document.querySelectorAll(".detail");
					
					for (let i = 0; i < detail.length; i++) {
						detail[i].addEventListener("click", () => {
							const endpoint = "http://localhost:8080/Amazon/details";
							const id = detail[i].id;
							const data = {
								method: "POST",
								body: JSON.stringify(parseInt(id))
							};
							fetch(endpoint, data)
							.then((res) => {
								if(res.status == 200) {
									window.location.href = "http://localhost:8080/Amazon/public/views/details.html";
								} else {
									window.alert("You are not connected to internet");
								}
							})
							.catch((err) => {
								console.log(err);
							});
						});
					};
				});
			</script>
		</body>
	</html>

